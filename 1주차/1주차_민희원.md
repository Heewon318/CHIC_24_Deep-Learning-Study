# 파이토치 기초(45p ~ 155p)

3장 전체 내용을 읽고 정리한 내용입니다.

## 텐서(Tensor)

: 배열(Array)이나 행렬(Matrix)과 유사한 자료형.

- 넘파이 라이브러리의 ndarray 클래스와 유사한 구조.
- 모델의 입출력뿐만 아니라 모델의 배개변수를 부호화(Encode)하고 GPU를 활용해 연산을 가속화할 수 있음.
- 어떤 차원(Rank)으로 구성되느냐에 따라 텐서의 형태를 이해할 수 있음.
- 이미지 데이터를 학습시킬 때 주로 4차원의 배열 구조의 형태로 가장 많이 사용됨.
  - 이미지의 경우 **(N, C, H, W)** 로 표현함.
  - N : 이미지 개수, C : 채널, H : 이미지의 높이, W : 이미지의 너비

### 넘파이와 파이토치

> **공통점**
>
> 1.  수학 계산, 선형 대수 연산을 비롯해 다양한 연산 가능. (Transposing, Indexing, Slicing, Random sampling)

> **차이점**
>
> 1.  CPU에서 사용하는 텐서와 GPU에서 사용하는 텐서의 선언 방식에 있음.
> 2.  파이토치는 **GPU가속(GPU Acceleration)** 을 적용할 수 있으므로 CPU 텐서와 GPU 텐서로 나눠지고, 각각의 텐서를 상호 변환하거나 GPU 사용 여부를 설정.

### 텐서 생성

**torch.tensor()** 소문자

- 입력된 데이터를 복사해 텐서로 변환하는 함수.
- 데이터를 복사하기 때문에 **값이 무조건 존재**해야 하며 입력된 **데이터의 형식에 가장 적합한 텐서 자료형으로 변환함**.

**torch.Tensor()** 대문자

- 텐서의 기본형으로 텐서 인스턴스를 생성하는 클래스
- 값을 입력하지 않는 경우 비어 있는 텐서 생성
- 가능한 **자료형이 명확하게 표현되는 클래스** 형태의 torch.Tensor()를 사용하는 것을 권장.

**Torch.tensor**

- 비어 있는 구조로 생성되지 않고 **자동으로 자료형을 할당**하기 때문에 의도하지 않은 자료형으로 변경될 수 있으니 **사용에 주의**

이외에도 IntTensor, LongTensor, FloatTensor가 많이 활용됨.

### 텐서 속성

> **형태(shape), 자료형(dtype), 장치(device)** 가 존재함.

- shape, dtype은 넘파일 배열에서 사용하는 형태와 유사함.
- **형태**(shape, 텐서의 차원), **자료형**(dtype, 텐서에 할당된 데이터 형식), **장치**(device, **텐서의 GPU 가속 여부**-넘파이 배열에서 사용X.)
- 텐서 연산을 진행할 때, **세 가지 속성 중 하나라도 맞지 않으면 작동하지 않으니 주의**.

torch.rand(): 0 이상 1 미만의 무작위 숫자를 균등 분포로 생성하는 함수.

### 차원 변환

> 가장 많이 사용되는 메서드 중 하나. 머신러닝 **연산과정이나 입출력 변환** 등에 많이 활용됨.

**tensor.reshape()** 메서드를 활용하여 차원 변환 가능.

### 자료형 설정

> - 텐서에 있어서 가장 중요한 요소
> - 넘파이 설정 방식과 동일하나 **선언 방식**에 있어 차이점 존재.

```
import torch

tensor = torch.rand((3, 3), dtype=torch.float)
print(tensor)
```

**torch.\*** 형태로 할당해야 함.

torch.float가 아닌 float를 할당해도 오류 없이 작동하지만, **자료형 관점**에서 보면 `torch.float`(32비트 부동 소수점), `float`(64비트 부동 소수점)의 차이가 있다.

> float로 할당한다면 torch.float보다 더 큰 범위의 숫자를 저장함. -> 더 많은 메모리를 필요로 하게 되고 일부 학습 과정에서 더 많은 자원을 필요로 하게 된다.

텐서를 선언할 때는 **가능한 torch. \* 형태로 정확한 자료형을 할당**한다.

### 장치 설정

> GPU 학습에서 가장 중요한 설정.

장치 설정을 정확하게 할당하지 않으면 **실행 오류(Runtime Error)** 가 발생하거나 `CPU 연산`이 되어 **학습하는 데 오랜 시간이 소요**.

```
import torch

device = "cuda" if torch.cuda.is_available() else "cpu"        #cuda?
cpu = torch.FloatTensor([1, 2, 3])
gpu = torch.cuda.FloatTensor([1, 2, 3])
tensor = torch.rand((1, 1), device=device)
```

- 텐서의 장치 설정은 device 매개변수에 장치 속성을 할당해 설정할 수 있음.
- `torch.cuda.is_available` 함수로 **CUDA 사용 여부**를 확인 할 수 있음.
  - 장치 속성 변수를 선언해 **현재 소스 코드에 활용되는 장치를 통일**시킬 수 있음.
- `Tensor 클래스`의 경우 device 매개변수가 존재하지만, CUDA용 클래스가 별도로 존재하므로 `torch.cuda.Tensor` 클래스를 사용.
  - 특정 데이터에서 복사해 텐서를 적용하는 경우 device 매개변수에 장치값을 할당함.
  - device 속성에는 cpu, cuda, mps(맥) 이외에도 mkldnn. opengl, opencl, ideep, hip.msnpu, xla 등이 존재.
